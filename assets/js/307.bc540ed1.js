(window.webpackJsonp=window.webpackJsonp||[]).push([[307],{511:function(t,s,a){"use strict";a.r(s);var e=a(5),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"模拟飞腾d2000-银河麒麟v10部署java环境"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#模拟飞腾d2000-银河麒麟v10部署java环境"}},[t._v("#")]),t._v(" 模拟飞腾D2000+银河麒麟V10部署java环境")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("模拟设备及目标设备")]),t._v(" "),a("p",[t._v("原始设备：\nCPU: AMD Ryzen 7 4800H with Radeon Graphics 2.90 GHz\nRAM: 12GB")]),t._v(" "),a("p",[t._v("模拟目标设备：\nCPU: Cortex-A57(ARMv8-a) 8核心 8线程  （飞腾D2000兼容ARMv8-a指令集架构）\nRAM: 8GB")]),t._v(" "),a("p",[t._v("模拟系统： 银河麒麟v10桌面版")])]),t._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[t._v("关于软件源")]),t._v(" "),a("p",[t._v("飞腾版无法修改软件源，即使强行修改也会报依赖错误并且系统会自动重置源。")]),t._v(" "),a("p",[t._v("如果发现软件管理工具无法搜索到 mysql jdk rides等开源工具，那么可以直接找麒麟的技术支持，提供系统序列码，很有可能是软件源的问题，没有响应的访问权限所导致的")]),t._v(" "),a("p",[t._v("关闭麒麟安全认证")]),t._v(" "),a("p",[t._v('~~1、打开终端，输入 sudo vim /etc/default/grub 命令修改该配置文件，将 GRUB_CMDLINE_LINUX_SECURITY="security=后面的内容清空后保存退出；')]),t._v(" "),a("p",[t._v("2、更新 grub 选项：")]),t._v(" "),a("p",[t._v("$ update-grub")]),t._v(" "),a("p",[t._v("3、最后重启一下电脑即可。~~")]),t._v(" "),a("p",[t._v("关闭针对执行程序和网络请求的安全认证，方便安装后续环境")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("sudo setstatus -f netctl off\n\nsudo setstatus -f exectl off\n\ngetstatus\n")])])])]),t._v(" "),a("p",[a("strong",[t._v("1. 使用qemu配置模拟环境")]),t._v("\nwindows平台可以直接下载编译好的二进制文件，linux下需要下载源码自行编译。")]),t._v(" "),a("p",[a("strong",[t._v("2. 在qemu模拟器中安装麒麟系统")]),t._v("\n麒麟系统直接在官方申请下载即可")]),t._v(" "),a("p",[t._v("我下载的是 麒麟V10 桌面版 飞腾版本和麒麟V10 服务器飞腾版  （其实就是ARM64版本，一模一样）。桌面版可以正常安装，但是服务器版本在安装界面卡在右上角有个光标 就不继续了。")]),t._v(" "),a("p",[t._v("准备好下载好用的麒麟镜像 重命名为 "),a("code",[t._v("kylin.iso")])]),t._v(" "),a("p",[t._v("(下载EFI引导)[https://releases.linaro.org/components/kernel/uefi-linaro/latest/release/qemu64/QEMU_EFI.fd] ,下载完和"),a("code",[t._v("kylin.iso")]),t._v("放一起")]),t._v(" "),a("p",[t._v("最后在当前目录下打开命令行，执行如下命令")]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("qemu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("img create "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f qcow2 armrootfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qcow2 20G \n\nqemu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("system"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aarch64 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m 4096 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cpu cortex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a72 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("smp 4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cores=4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("threads=1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sockets=1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("M virt "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bios QEMU_EFI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("net nic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("model=pcnet "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device nec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("usb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("xhci "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device usb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("kbd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device usb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mouse "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device VGA "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("drive "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v("=none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("file="),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("kylin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("iso"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("id=cdrom"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("media=cdrom "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device virtio"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scsi"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device scsi"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("drive=cdrom "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("drive "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v("=none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("file=armrootfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qcow2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("id=hd0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device virtio"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("blk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("drive=hd0\n\n\n")])])]),a("p",[t._v("之后会出现图形化界面，进入到系统安装界面，按照流程安装系统就行，之后启动系统的时候执行如下命令")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("注意，执行下面的启动系统命令之前")]),t._v(" "),a("p",[t._v("不配置的话启动系统会报错 \t"),a("code",[t._v("找不到tap0")])]),t._v(" "),a("p",[a("strong",[t._v("步骤：")]),t._v('  需要下载windows-tap 创建一个网络适配器并重命名为tap0，并将本地网络共享给适配器tap0，同时qemu启动命令也需要改变，具体操作必应搜索 "qemu tap-windows"')])]),t._v(" "),a("div",{staticClass:"language-powershell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-powershell"}},[a("code",[t._v("\nqemu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("system"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("aarch64 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("m 8192 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cpu cortex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("a57 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("smp 8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("cores=4"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("threads=2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sockets=1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("bios QEMU_EFI"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("fd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("net nic"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("model=pcnet   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("net tap"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ifname=tap0  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device nec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("usb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("xhci "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device usb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("kbd "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device usb"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("mouse "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device VGA   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device virtio"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scsi"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("drive "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v("=none"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("file=armrootfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("qcow2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("id=hd0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device virtio"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("blk"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("device"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("drive=hd0 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("machine "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("type")]),t._v("=virt\n\n\n")])])]),a("p",[t._v("需要注意的是 上述命令中 参数  "),a("code",[t._v("-m 8192")]),t._v("中"),a("code",[t._v("8192")]),t._v("代表的是模拟器的系统内存，单位是MB, "),a("code",[t._v("-smp 8,cores=4,threads=2,sockets=1")]),t._v("中 smp = cores"),a("em",[t._v("threads")]),t._v("sockets, cores是核心数，threads是每个核心的线程数，sockets是cpu个数")]),t._v(" "),a("p",[a("strong",[t._v("3.kylin软件镜像源相关问题")])]),t._v(" "),a("p",[t._v("更新镜像源了，但是找不到java，openssh等大部分常见的软件，并且麒麟系统会自动重置apt镜像源回系统默认。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("windows平台使用qemu模拟arm下安装kylinv10 只能安装桌面版不能安装服务器版"),a("br"),t._v("\n而桌面版和服务器版本完全不一样（一个基于ubuntu 一个基于centos）")]),t._v(" "),a("p",[a("s",[t._v("所以接下来选择  在vmware中线安装AMD64版本的kylin-server v10系统，然后在该系统中 使用qemu模拟arm64安装arm64版本的kylin-server v10\n假设已经在windows上的vmware中安装好了kylin-server,接下来进行如下操作")])]),t._v(" "),a("p",[t._v("询问客服之后，对方说系统应该自带java，后来向技术服务人员提供了系统序列号之后，神奇的事情发生了，能搜到jdk了。所以我感觉是源的问题，没有激活系统导致无法访问官方源")])]),t._v(" "),a("p",[a("strong",[t._v("1.先将系统更新到最新")])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("执行前确保以root用户身份执行")])]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("yum update "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" yum upgrade\n\n")])])]),a("p",[a("strong",[t._v("2.根据官方文档安装qemu")])]),t._v(" "),a("p",[t._v("https://wiki.qemu.org/Hosts/Linux")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("出现的问题")]),t._v(" "),a("p",[t._v("python版本过低：安装python3.8来解决该问题")]),t._v(" "),a("p",[t._v("参照官方文档  https://docs.python.org/3.8/using/unix.html#getting-and-installing-the-latest-version-of-python")]),t._v(" "),a("p",[t._v("可以不安装python，只在kylin上编译出可执行文件pyhton即可，然后继续qemu教程中的 configure --enable-debug命令，和官方不同的是，这次在结尾加上参数指定python执行文件的位置  "),a("code",[t._v("configure --enable-debug --python=path/to/python")])]),t._v(" "),a("p",[t._v("然后又出错了 gcc版本过低，需要7.4版本才能继续编译qemu")]),t._v(" "),a("p",[t._v("最终解决方案 直接用qemu历史版本5.0版本，（python和gcc都不用更新了）")])])])}),[],!1,null,null,null);s.default=r.exports}}]);