(window.webpackJsonp=window.webpackJsonp||[]).push([[223],{429:function(s,a,t){"use strict";t.r(a);var e=t(5),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"java诊断利器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#java诊断利器"}},[s._v("#")]),s._v(" java诊断利器")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("参考")]),s._v(" "),t("p",[s._v("https://github.com/alibaba/arthas")])]),s._v(" "),t("ol",[t("li",[s._v("下载并启动一个java项目")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -O https://github.com/frunoob/images/blob/main/2022/8/31/14/2/44/math-game.jar?raw"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\njava -jar math-game.jar\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("启动arthas")])]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("执行该程序的用户需要和目标进程具有相同的权限。比如以admin用户来执行：sudo su admin && java -jar arthas-boot.jar 或 sudo -u admin -EH java -jar arthas-boot.jar。"),t("br"),s._v("\n如果 attach 不上目标进程，可以查看~/logs/arthas/ 目录下的日志。"),t("br"),s._v("\n如果下载速度比较慢，可以使用 aliyun 的镜像：java -jar arthas-boot.jar --repo-mirror aliyun --use-http"),t("br"),s._v("\njava -jar arthas-boot.jar -h 打印更多参数信息。")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -O https://github.com/frunoob/images/blob/main/2022/8/31/14/2/44/arthas-boot.jar?raw"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\njava -jar arthas-boot.jar\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("选择指定的java进程编号进行绑定。")])]),s._v(" "),t("p",[t("strong",[s._v("一些命令的使用")])]),s._v(" "),t("ol",[t("li",[s._v("dashboard")])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arthas@11916"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$ dashboard\nID NAME                 GROUP     PRIORI STATE %CPU   DELTA_ TIME   INTER DAEMON\n-1 C1 CompilerThread2   -         -1     -     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":1.34 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n-1 C2 CompilerThread0   -         -1     -     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.89 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n-1 C2 CompilerThread1   -         -1     -     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.87 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" arthas-command-execu system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.60 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  main                 main      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      TIMED "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.50 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(" arthas-NettyWebsocke system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.34 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" arthas-NettyHttpTeln system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.20 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" arthas-NettyWebsocke system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.06 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" arthas-NettyWebsocke system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.04 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n-1 VM Thread            -         -1     -     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.04 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  Attach Listener      system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.03 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" arthas-TermServer-1- system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.03 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" arthas-NettyHttpTeln system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.01 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" arthas-NettyWebsocke system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.01 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("35")]),s._v(" arthas-TermServer-1- system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.01 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v(" Timer-for-arthas-das system    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("      RUNNA "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.000")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":0.01 "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nMemory            used total max   usage GC\nheap              86M  160M  3621M "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.39")]),s._v("%                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\nps_eden_space     56M  64M   1337M "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.22")]),s._v("% gc.ps_scavenge.time "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("\nps_survivor_space 10M  10M   10M         "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nps_old_gen        19M  86M   2716M "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.72")]),s._v("% gc.ps_marksweep.cou "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\nnonheap           43M  45M   -1          nt\ncode_cache        7M   8M    240M  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.04")]),s._v("% gc.ps_marksweep.tim "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("\nmetaspace         32M  33M   -1          e"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ncompressed_class_ 3M   4M    1024M "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.38")]),s._v("%\nspace\ndirect            0K   0K    -     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v("%\nRuntime\nos.name                                  Windows "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\nos.version                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v("\njava.version                             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(".0_332\njava.home                                C:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Program Files"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("Eclipse Adoptium"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("jdk-8\n                                         .0.332.9-hotspot"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("jre\nsystemload.average                       -1.00\nprocessors                               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arthas@11916"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("$\n")])])]),t("p",[s._v("可以看到当前堆内存的使用量，以及堆内存中eden_space、old_gen的使用情况。\nnon-heap是不受jvm管控的，为jvm提供内存的空间。")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[t("p",[s._v("sc-搜索所有被jvm加载的类")])]),s._v(" "),t("li",[t("p",[s._v("展示线程信息，线程栈")])])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到指定id的线程")]),s._v("\nthread "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 显示前3个最活跃的线程")]),s._v("\nthread -n "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找出当前导致阻塞的线程（synchronied锁）")]),s._v("\nthread -b\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 找到指定状态的线程")]),s._v("\nthread --state \n")])])]),t("ol",{attrs:{start:"4"}},[t("li",[t("p",[s._v("decompile\n"),t("code",[s._v("jad demo.MathGame")])])]),s._v(" "),t("li",[t("p",[s._v("监测指定方法调用的输入输出参数、返回对象、和抛出的异常。")])])]),s._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以下是可能用到的表达式")]),s._v("\n           target "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" the object\n            clazz "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" the object"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s class\n           method : the constructor or method\n           params : the parameters array of method\n     params[0..n] : the element of parameters array\n        returnObj : the returned object of method\n         throwExp : the throw exception of method\n         isReturn : the method ended by return\n          isThrow : the method ended by throwing exception\n            #cost : the execution time in ms of method invocation\n      \n# 例子\nwatch org.apache.commons.lang.StringUtils isBlank '")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("params, target, returnObj, throwExp"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("' -x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" *StringUtils isBlank params"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" param"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".length"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("watch")]),s._v(" \n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);